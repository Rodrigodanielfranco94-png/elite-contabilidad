<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro Elite Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body class="bg-slate-900 text-white p-4 pb-20">
    <h1 class="text-xl font-bold mb-4 text-center text-blue-400">ELITE CLEANERS - REGISTRO DIARIO</h1>
    
    <div class="space-y-3 bg-slate-800 p-5 rounded-2xl shadow-lg mb-6">
        <div class="flex flex-col gap-1">
            <label class="text-[10px] text-slate-400 ml-1">FECHA DEL TRABAJO</label>
            <input type="date" id="fecha" class="w-full bg-slate-700 p-3 rounded-lg text-white">
        </div>
        <input type="number" id="ingresos" class="w-full bg-slate-700 p-3 rounded-lg" placeholder="Ingreso Total ($)">
        <input type="number" id="gastosDiarios" class="w-full bg-slate-700 p-3 rounded-lg" placeholder="Gastos (Cena/Almuerzo) ($)">
        <input type="number" id="horas" class="w-full bg-slate-700 p-3 rounded-lg" placeholder="Horas Totales">
        <input type="number" id="inversion" class="w-full bg-slate-700 p-3 rounded-lg" placeholder="Inversión (Lowe's/Walmart) ($)">

        <button onclick="registrarTrabajo()" class="w-full bg-blue-600 py-4 rounded-xl font-bold mt-2 shadow-lg active:bg-blue-700 text-lg">GUARDAR REGISTRO</button>
    </div>

    <div class="flex justify-between items-center mb-3 px-2">
        <h2 class="text-lg font-bold text-blue-300">HISTORIAL</h2>
        <button onclick="exportarExcel()" class="bg-green-600 text-[10px] px-3 py-2 rounded-lg font-bold uppercase shadow-md">Exportar Excel</button>
    </div>

    <div id="historial" class="space-y-3"></div>

    <script>
        window.onload = mostrarHistorial;

        function registrarTrabajo() {
            const fecha = document.getElementById('fecha').value || new Date().toISOString().split('T')[0];
            const ing = parseFloat(document.getElementById('ingresos').value) || 0;
            const gas = parseFloat(document.getElementById('gastosDiarios').value) || 0;
            const hrs = parseFloat(document.getElementById('horas').value) || 0;
            const inv = parseFloat(document.getElementById('inversion').value) || 0;

            if(ing === 0) return alert("Por favor, ingresa el monto");

            const pStaff = hrs * 18; // Antes Geral
            const neta = ing - gas;
            const cadaUno = (neta * 0.70) / 2;
            const eNeto = (neta * 0.30) - inv;

            const nuevoTrabajo = { fecha, ing, gas, hrs, pStaff, cadaUno, inv, eNeto };

            let trabajos = JSON.parse(localStorage.getItem('elite_trabajos')) || [];
            trabajos.unshift(nuevoTrabajo);
            localStorage.setItem('elite_trabajos', JSON.stringify(trabajos));

            // Limpiar campos
            ["ingresos", "gastosDiarios", "horas", "inversion"].forEach(id => document.getElementById(id).value = "");
            mostrarHistorial();
        }

        function mostrarHistorial() {
            const lista = document.getElementById('historial');
            const trabajos = JSON.parse(localStorage.getItem('elite_trabajos')) || [];
            
            lista.innerHTML = trabajos.map((t, index) => `
                <div class="bg-slate-800 p-4 rounded-xl border-l-4 border-blue-500 shadow-md">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-blue-400 font-bold">${t.fecha}</span>
                        <span class="text-green-400 font-bold">$${t.ing.toFixed(2)}</span>
                    </div>
                    <div class="grid grid-cols-2 gap-2 text-[11px]">
                        <div class="bg-slate-700 p-2 rounded">PAGO DUEÑOS:<br><b class="text-white">$${t.cadaUno.toFixed(2)} c/u</b></div>
                        <div class="bg-slate-700 p-2 rounded">PAGO STAFF:<br><b class="text-yellow-400">$${t.pStaff.toFixed(2)}</b></div>
                        <div class="bg-slate-700 p-2 rounded col-span-2 text-center border border-slate-600">
                            EMPRESA NETO: <b class="text-blue-300">$${t.eNeto.toFixed(2)}</b>
                        </div>
                    </div>
                    <button onclick="borrarUno(${index})" class="text-[10px] text-red-500 mt-2 underline opacity-50">Eliminar</button>
                </div>
            `).join('');
        }

        function exportarExcel() {
            const trabajos = JSON.parse(localStorage.getItem('elite_trabajos')) || [];
            if(trabajos.length === 0) return alert("No hay datos para exportar");

            const data = trabajos.map(t => ({
                "Fecha": t.fecha,
                "Ingresos": t.ing,
                "Gastos": t.gas,
                "Horas": t.hrs,
                "Pago Staff": t.pStaff,
                "Pago Rodrigo": t.cadaUno,
                "Pago Dayana": t.cadaUno,
                "Inversión": t.inv,
                "Empresa Neto": t.eNeto
            }));

            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Contabilidad");
            XLSX.writeFile(wb, "Elite_Cleaners_Contabilidad.xlsx");
        }

        function borrarUno(index) {
            if(confirm("¿Borrar este registro?")) {
                let trabajos = JSON.parse(localStorage.getItem('elite_trabajos'));
                trabajos.splice(index, 1);
                localStorage.setItem('elite_trabajos', JSON.stringify(trabajos));
                mostrarHistorial();
            }
        }
    </script>
</body>
</html>
